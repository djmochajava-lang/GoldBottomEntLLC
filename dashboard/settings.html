<!-- dashboard/settings.html — Company Settings & Business Checklist -->
<div class="dashboard-page" id="dash-settings">
  <div class="dashboard-page-header">
    <div><h1>Settings</h1><p class="text-muted">Company information, preferences, and business setup checklist.</p></div>
  </div>

  <!-- Tabs -->
  <div class="tabs" id="settings-tabs">
    <button class="tab active" data-tab="tab-company"><i class="fa-solid fa-building"></i> Company Info</button>
    <button class="tab" data-tab="tab-owner"><i class="fa-solid fa-user"></i> Owner Profile</button>
    <button class="tab" data-tab="tab-checklist"><i class="fa-solid fa-list-check"></i> Business Checklist</button>
    <button class="tab" data-tab="tab-preferences"><i class="fa-solid fa-sliders"></i> Preferences</button>
  </div>

  <!-- =========================================
       TAB: Company Info
       ========================================= -->
  <div class="tab-panel active" id="tab-company">
    <div class="glass-card" style="max-width:720px;">
      <h3 style="margin-bottom:var(--space-md);"><i class="fa-solid fa-building text-gold"></i> Company Information</h3>
      <form id="company-form">
        <div class="grid grid-2">
          <div class="form-group">
            <label class="form-label">Company Name</label>
            <input type="text" class="form-input" name="companyName" value="Gold Bottom Ent LLC" />
          </div>
          <div class="form-group">
            <label class="form-label">DBA / Trade Names</label>
            <input type="text" class="form-input" name="dba1" value="Gold Bottom Entertainment" style="margin-bottom:var(--space-xs);" />
            <input type="text" class="form-input" name="dba2" value="Gold Bottom Enterprise" />
          </div>
        </div>
        <div class="grid grid-2">
          <div class="form-group">
            <label class="form-label">EIN</label>
            <input type="text" class="form-input" name="ein" placeholder="[YOUR EIN HERE]" />
          </div>
          <div class="form-group">
            <label class="form-label">State of Formation</label>
            <input type="text" class="form-input" name="stateOfFormation" value="Maryland" />
          </div>
        </div>
        <div class="form-group">
          <label class="form-label">Business Address</label>
          <textarea class="form-textarea" name="address" rows="2" placeholder="Street, City, State, ZIP"></textarea>
        </div>
        <div class="grid grid-2">
          <div class="form-group">
            <label class="form-label">Business Phone</label>
            <input type="tel" class="form-input" name="phone" placeholder="(555) 000-0000" />
          </div>
          <div class="form-group">
            <label class="form-label">Business Email</label>
            <input type="email" class="form-input" name="email" placeholder="info@goldbottom-ent.com" />
          </div>
        </div>
        <div class="form-group">
          <label class="form-label">Website URL</label>
          <input type="url" class="form-input" name="website" placeholder="https://goldbottom-ent.com" />
        </div>
        <div class="divider"></div>
        <h3 style="margin-bottom:var(--space-md);"><i class="fa-solid fa-user-tie text-gold"></i> Professional Contacts</h3>
        <div class="grid grid-2">
          <div class="form-group">
            <label class="form-label">Registered Agent Name</label>
            <input type="text" class="form-input" name="registeredAgent" placeholder="Agent name..." />
          </div>
          <div class="form-group">
            <label class="form-label">Registered Agent Address</label>
            <input type="text" class="form-input" name="registeredAgentAddress" placeholder="Agent address..." />
          </div>
        </div>
        <div class="grid grid-2">
          <div class="form-group">
            <label class="form-label">Attorney Name</label>
            <input type="text" class="form-input" name="attorney" placeholder="Attorney name..." />
          </div>
          <div class="form-group">
            <label class="form-label">Attorney Contact</label>
            <input type="text" class="form-input" name="attorneyContact" placeholder="Phone or email..." />
          </div>
        </div>
        <div class="grid grid-2">
          <div class="form-group">
            <label class="form-label">CPA / Accountant Name</label>
            <input type="text" class="form-input" name="accountant" placeholder="Accountant name..." />
          </div>
          <div class="form-group">
            <label class="form-label">Accountant Contact</label>
            <input type="text" class="form-input" name="accountantContact" placeholder="Phone or email..." />
          </div>
        </div>
        <div class="grid grid-2">
          <div class="form-group">
            <label class="form-label">Insurance Provider</label>
            <input type="text" class="form-input" name="insurance" placeholder="Insurance company..." />
          </div>
          <div class="form-group">
            <label class="form-label">Policy Number</label>
            <input type="text" class="form-input" name="insurancePolicyNumber" placeholder="Policy #..." />
          </div>
        </div>
        <div style="margin-top:var(--space-md);">
          <button type="button" class="btn btn-primary" id="save-company-btn"><i class="fa-solid fa-floppy-disk"></i> Save Changes</button>
        </div>
      </form>
    </div>
  </div>

  <!-- =========================================
       TAB: Owner Profile
       ========================================= -->
  <div class="tab-panel" id="tab-owner">
    <div class="glass-card" style="max-width:720px;">
      <h3 style="margin-bottom:var(--space-md);"><i class="fa-solid fa-user text-gold"></i> Owner Profile</h3>
      <form id="owner-form">
        <div class="grid grid-2">
          <div class="form-group">
            <label class="form-label">Full Name</label>
            <input type="text" class="form-input" name="ownerName" value="DJ Moka" />
          </div>
          <div class="form-group">
            <label class="form-label">Title / Role</label>
            <input type="text" class="form-input" name="ownerTitle" value="Owner / Managing Member" />
          </div>
        </div>
        <div class="grid grid-2">
          <div class="form-group">
            <label class="form-label">Email</label>
            <input type="email" class="form-input" name="ownerEmail" placeholder="owner@goldbottom-ent.com" />
          </div>
          <div class="form-group">
            <label class="form-label">Phone</label>
            <input type="tel" class="form-input" name="ownerPhone" placeholder="(555) 000-0000" />
          </div>
        </div>
        <div class="form-group">
          <label class="form-label">Bio</label>
          <textarea class="form-textarea" name="ownerBio" rows="3" placeholder="A short professional bio..."></textarea>
        </div>
        <div class="divider"></div>
        <h3 style="margin-bottom:var(--space-md);"><i class="fa-solid fa-share-nodes text-gold"></i> Social Links</h3>
        <div class="grid grid-2">
          <div class="form-group">
            <label class="form-label"><i class="fa-brands fa-instagram" style="margin-right:6px;"></i>Instagram</label>
            <input type="url" class="form-input" name="socialInstagram" placeholder="https://instagram.com/..." />
          </div>
          <div class="form-group">
            <label class="form-label"><i class="fa-brands fa-facebook" style="margin-right:6px;"></i>Facebook</label>
            <input type="url" class="form-input" name="socialFacebook" placeholder="https://facebook.com/..." />
          </div>
        </div>
        <div class="grid grid-2">
          <div class="form-group">
            <label class="form-label"><i class="fa-brands fa-twitter" style="margin-right:6px;"></i>Twitter</label>
            <input type="url" class="form-input" name="socialTwitter" placeholder="https://twitter.com/..." />
          </div>
          <div class="form-group">
            <label class="form-label"><i class="fa-brands fa-linkedin" style="margin-right:6px;"></i>LinkedIn</label>
            <input type="url" class="form-input" name="socialLinkedin" placeholder="https://linkedin.com/in/..." />
          </div>
        </div>
        <div class="form-group" style="max-width:calc(50% - var(--space-lg)/2);">
          <label class="form-label"><i class="fa-brands fa-github" style="margin-right:6px;"></i>GitHub</label>
          <input type="url" class="form-input" name="socialGithub" placeholder="https://github.com/..." />
        </div>
        <div style="margin-top:var(--space-md);">
          <button type="button" class="btn btn-primary" id="save-owner-btn"><i class="fa-solid fa-floppy-disk"></i> Save Profile</button>
        </div>
      </form>
    </div>
  </div>

  <!-- =========================================
       TAB: Business Checklist
       ========================================= -->
  <div class="tab-panel" id="tab-checklist">
    <!-- Overall progress -->
    <div class="glass-card" style="margin-bottom:var(--space-lg);">
      <div style="display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:var(--space-sm);">
        <h3 style="margin:0;"><i class="fa-solid fa-list-check text-gold"></i> Business Setup Checklist</h3>
        <span id="checklist-overall" style="font-size:var(--text-sm);color:var(--color-text-secondary);"><strong>0</strong> of <strong>32</strong> tasks completed</span>
      </div>
      <div style="margin-top:var(--space-sm);height:8px;background:var(--color-bg-tertiary);border-radius:var(--radius-full);overflow:hidden;">
        <div id="checklist-overall-bar" style="height:100%;background:linear-gradient(90deg,var(--color-gold),var(--color-gold-light));border-radius:var(--radius-full);transition:width 0.4s ease;width:0%;"></div>
      </div>
    </div>

    <div id="checklist-container"></div>

    <style>
      .checklist-section { margin-bottom: var(--space-lg); }
      .checklist-section-header {
        display: flex; align-items: center; justify-content: space-between;
        margin-bottom: var(--space-sm); padding-bottom: var(--space-xs);
        border-bottom: 1px solid var(--color-border);
      }
      .checklist-section-header h3 {
        font-size: var(--text-base); font-weight: var(--fw-semibold);
        color: var(--color-text); margin: 0;
      }
      .checklist-section-progress {
        font-size: var(--text-xs); color: var(--color-text-muted);
      }
      .checklist-progress-bar {
        height: 4px; background: var(--color-bg-tertiary);
        border-radius: var(--radius-full); overflow: hidden; margin-bottom: var(--space-sm);
      }
      .checklist-progress-fill {
        height: 100%; background: var(--color-gold);
        border-radius: var(--radius-full); transition: width 0.3s ease;
      }
      .checklist-item {
        display: flex; align-items: center; gap: var(--space-sm);
        padding: var(--space-sm) var(--space-md); border-radius: var(--radius-sm);
        transition: background var(--transition-fast); cursor: pointer;
      }
      .checklist-item:hover { background: var(--color-bg-tertiary); }
      .checklist-item input[type="checkbox"] {
        width: 18px; height: 18px; accent-color: var(--color-gold);
        cursor: pointer; flex-shrink: 0;
      }
      .checklist-item label {
        font-size: var(--text-sm); color: var(--color-text-secondary);
        cursor: pointer; flex: 1; line-height: 1.4;
      }
      .checklist-item.completed label {
        text-decoration: line-through; color: var(--color-text-muted);
      }
    </style>
  </div>

  <!-- =========================================
       TAB: Preferences
       ========================================= -->
  <div class="tab-panel" id="tab-preferences">
    <div class="glass-card" style="max-width:600px;">
      <h3 style="margin-bottom:var(--space-md);"><i class="fa-solid fa-palette text-gold"></i> Appearance</h3>
      <div class="form-group">
        <label class="form-label">Theme</label>
        <select class="form-select" id="pref-theme" style="max-width:200px;">
          <option value="dark" selected>Dark (Default)</option>
          <option value="light" disabled>Light (Coming Soon)</option>
        </select>
      </div>

      <div class="divider"></div>
      <h3 style="margin-bottom:var(--space-md);"><i class="fa-solid fa-bell text-gold"></i> Notifications</h3>
      <div class="form-group">
        <label class="form-checkbox"><input type="checkbox" id="pref-notifyEmail" checked /> Email notifications</label>
      </div>
      <div class="form-group">
        <label class="form-checkbox"><input type="checkbox" id="pref-notifyContracts" checked /> Contract reminders</label>
      </div>
      <div class="form-group">
        <label class="form-checkbox"><input type="checkbox" id="pref-notifyTax" checked /> Tax deadline reminders</label>
      </div>
      <div class="form-group">
        <label class="form-checkbox"><input type="checkbox" id="pref-notifyBooking" checked /> Booking alerts</label>
      </div>
      <div style="margin-top:var(--space-sm);">
        <button type="button" class="btn btn-primary btn-sm" id="save-prefs-btn"><i class="fa-solid fa-floppy-disk"></i> Save Preferences</button>
      </div>

      <div class="divider"></div>
      <h3 style="margin-bottom:var(--space-md);"><i class="fa-solid fa-database text-gold"></i> Data Management</h3>
      <div style="display:flex;gap:var(--space-sm);flex-wrap:wrap;">
        <button type="button" class="btn btn-secondary btn-sm" id="export-data-btn"><i class="fa-solid fa-download"></i> Export All Data</button>
        <button type="button" class="btn btn-danger btn-sm" id="reset-data-btn"><i class="fa-solid fa-trash-can"></i> Reset All Data</button>
      </div>

      <div class="divider"></div>
      <div style="font-size:var(--text-xs);color:var(--color-text-muted);">
        <strong>Gold Bottom Ent. LLC</strong> &mdash; Dashboard Portal<br/>
        Version: <span id="app-version">1.0.0-prototype</span>
      </div>
    </div>
  </div>
</div>

<script>
(function(){
  if(typeof DataStore==='undefined')return;

  /* ============================================
     TAB SWITCHING
     ============================================ */
  var tabBtns = document.querySelectorAll('#settings-tabs .tab');
  tabBtns.forEach(function(btn){
    btn.addEventListener('click', function(){
      tabBtns.forEach(function(b){ b.classList.remove('active'); });
      btn.classList.add('active');
      var panels = document.querySelectorAll('#dash-settings .tab-panel');
      panels.forEach(function(p){ p.classList.remove('active'); });
      var target = document.getElementById(btn.getAttribute('data-tab'));
      if(target) target.classList.add('active');
    });
  });

  /* ============================================
     COMPANY INFO — Load & Save
     ============================================ */
  var companyFields = ['companyName','dba1','dba2','ein','stateOfFormation','address','phone','email','website',
    'registeredAgent','registeredAgentAddress','attorney','attorneyContact',
    'accountant','accountantContact','insurance','insurancePolicyNumber'];

  function loadCompanyForm(){
    var s = DataStore.getSettings();
    var form = document.getElementById('company-form');
    if(!form) return;
    companyFields.forEach(function(key){
      var el = form.elements[key];
      if(el && s[key]) el.value = s[key];
    });
  }

  var saveCompanyBtn = document.getElementById('save-company-btn');
  if(saveCompanyBtn){
    saveCompanyBtn.addEventListener('click', function(){
      var form = document.getElementById('company-form');
      var data = {};
      companyFields.forEach(function(key){
        var el = form.elements[key];
        if(el) data[key] = el.value;
      });
      DataStore.updateSettings(data);
      Toast.success('Company information saved');
    });
  }

  /* ============================================
     OWNER PROFILE — Load & Save
     ============================================ */
  var ownerFields = ['ownerName','ownerTitle','ownerEmail','ownerPhone','ownerBio',
    'socialInstagram','socialFacebook','socialTwitter','socialLinkedin','socialGithub'];

  function loadOwnerForm(){
    var s = DataStore.getSettings();
    var form = document.getElementById('owner-form');
    if(!form) return;
    ownerFields.forEach(function(key){
      var el = form.elements[key];
      if(el && s[key]) el.value = s[key];
    });
  }

  var saveOwnerBtn = document.getElementById('save-owner-btn');
  if(saveOwnerBtn){
    saveOwnerBtn.addEventListener('click', function(){
      var form = document.getElementById('owner-form');
      var data = {};
      ownerFields.forEach(function(key){
        var el = form.elements[key];
        if(el) data[key] = el.value;
      });
      DataStore.updateSettings(data);
      Toast.success('Owner profile saved');
    });
  }

  /* ============================================
     BUSINESS CHECKLIST
     ============================================ */
  function renderChecklist(){
    var checklist = DataStore.getChecklist();
    if(!checklist || !checklist.length) return;

    var container = document.getElementById('checklist-container');
    if(!container) return;

    // Group by category
    var categories = [];
    var catMap = {};
    checklist.forEach(function(item){
      if(!catMap[item.category]){
        catMap[item.category] = {name: item.category, items: []};
        categories.push(catMap[item.category]);
      }
      catMap[item.category].items.push(item);
    });

    var totalCompleted = 0;
    var totalItems = checklist.length;

    var html = '';
    categories.forEach(function(cat){
      var done = cat.items.filter(function(i){return i.checked;}).length;
      totalCompleted += done;
      var total = cat.items.length;
      var pct = total > 0 ? Math.round((done / total) * 100) : 0;

      html += '<div class="checklist-section glass-card">';
      html += '  <div class="checklist-section-header">';
      html += '    <h3>' + cat.name + '</h3>';
      html += '    <span class="checklist-section-progress">' + done + ' of ' + total + '</span>';
      html += '  </div>';
      html += '  <div class="checklist-progress-bar"><div class="checklist-progress-fill" style="width:' + pct + '%;"></div></div>';

      cat.items.forEach(function(item){
        var checkedAttr = item.checked ? ' checked' : '';
        var completedClass = item.checked ? ' completed' : '';
        html += '  <div class="checklist-item' + completedClass + '" data-id="' + item.id + '">';
        html += '    <input type="checkbox" id="chk-' + item.id + '"' + checkedAttr + ' />';
        html += '    <label for="chk-' + item.id + '">' + item.label + '</label>';
        html += '  </div>';
      });

      html += '</div>';
    });

    container.innerHTML = html;

    // Update overall progress
    var overallPct = totalItems > 0 ? Math.round((totalCompleted / totalItems) * 100) : 0;
    var overallEl = document.getElementById('checklist-overall');
    if(overallEl) overallEl.innerHTML = '<strong>' + totalCompleted + '</strong> of <strong>' + totalItems + '</strong> tasks completed';
    var overallBar = document.getElementById('checklist-overall-bar');
    if(overallBar) overallBar.style.width = overallPct + '%';

    // Bind checkbox events
    var checkboxes = container.querySelectorAll('input[type="checkbox"]');
    checkboxes.forEach(function(cb){
      cb.addEventListener('change', function(){
        var itemDiv = cb.closest('.checklist-item');
        var id = itemDiv ? itemDiv.getAttribute('data-id') : null;
        if(!id) return;
        DataStore.updateChecklistItem(id, cb.checked);
        renderChecklist();
      });
    });
  }

  /* ============================================
     PREFERENCES — Load & Save
     ============================================ */
  function loadPreferences(){
    var s = DataStore.getSettings();
    var prefFields = {
      'pref-notifyEmail': 'notifyEmail',
      'pref-notifyContracts': 'notifyContracts',
      'pref-notifyTax': 'notifyTax',
      'pref-notifyBooking': 'notifyBooking'
    };
    Object.keys(prefFields).forEach(function(elId){
      var el = document.getElementById(elId);
      var key = prefFields[elId];
      if(el && s[key] !== undefined) el.checked = !!s[key];
    });

    var themeEl = document.getElementById('pref-theme');
    if(themeEl && s.theme) themeEl.value = s.theme;

    var versionEl = document.getElementById('app-version');
    if(versionEl && typeof SiteConfig !== 'undefined') versionEl.textContent = SiteConfig.version || '1.0.0-prototype';
  }

  var savePrefsBtn = document.getElementById('save-prefs-btn');
  if(savePrefsBtn){
    savePrefsBtn.addEventListener('click', function(){
      var data = {
        theme: document.getElementById('pref-theme') ? document.getElementById('pref-theme').value : 'dark',
        notifyEmail: document.getElementById('pref-notifyEmail') ? document.getElementById('pref-notifyEmail').checked : true,
        notifyContracts: document.getElementById('pref-notifyContracts') ? document.getElementById('pref-notifyContracts').checked : true,
        notifyTax: document.getElementById('pref-notifyTax') ? document.getElementById('pref-notifyTax').checked : true,
        notifyBooking: document.getElementById('pref-notifyBooking') ? document.getElementById('pref-notifyBooking').checked : true
      };
      DataStore.updateSettings(data);
      Toast.success('Preferences saved');
    });
  }

  /* ============================================
     EXPORT & RESET
     ============================================ */
  var exportBtn = document.getElementById('export-data-btn');
  if(exportBtn){
    exportBtn.addEventListener('click', function(){
      var allData = {};
      Object.keys(DataStore.KEYS).forEach(function(k){
        var key = DataStore.KEYS[k];
        allData[k] = Utils.storage.get(key, null);
      });
      Utils.downloadJSON(allData, 'goldbottom-ent-backup-' + new Date().toISOString().slice(0,10) + '.json');
      Toast.success('Data exported successfully');
    });
  }

  var resetBtn = document.getElementById('reset-data-btn');
  if(resetBtn){
    resetBtn.addEventListener('click', function(){
      if(typeof Modal !== 'undefined'){
        Modal.confirm('This will erase ALL data and restore defaults. Are you sure?', function(){
          DataStore.resetAll();
          Toast.success('All data has been reset to defaults');
          // Reload forms and checklist
          loadCompanyForm();
          loadOwnerForm();
          renderChecklist();
          loadPreferences();
        });
      }
    });
  }

  /* ============================================
     INITIALIZE
     ============================================ */
  loadCompanyForm();
  loadOwnerForm();
  renderChecklist();
  loadPreferences();
})();
</script>
