<!-- dashboard/documents.html — Document Vault -->
<div class="dashboard-page" id="dash-documents">
  <div class="dashboard-page-header">
    <div style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:var(--spacing-sm);">
      <div><h1>Documents</h1><p class="text-muted">Store and track essential business documents.</p></div>
      <button class="btn btn-primary" id="upload-doc-btn"><i class="fa-solid fa-plus"></i> Upload Document</button>
    </div>
  </div>

  <!-- Document Category Cards -->
  <div class="grid grid-3" id="doc-cards-container" style="gap:var(--spacing-md);"></div>

  <!-- Document Tips -->
  <div class="glass-card" style="margin-top:var(--spacing-lg);">
    <h3><i class="fa-solid fa-lightbulb text-gold"></i> Important Reminders</h3>
    <ul style="list-style:disc;padding-left:20px;color:var(--color-text-secondary);line-height:1.8;">
      <li>Keep digital and physical copies of all documents.</li>
      <li>Store sensitive documents securely (consider encrypted cloud storage such as Google Drive or Tresorit).</li>
      <li>Review insurance policies annually and update coverage as your business grows.</li>
      <li>File annual reports with your state by the deadline to keep your LLC in good standing.</li>
      <li>Keep W-9 forms on file before paying any contractor.</li>
      <li>Issue 1099-NECs by January 31 for contractor payments over $600 in the prior year.</li>
    </ul>
  </div>
</div>

<script>
(function(){
  if(typeof DataStore==='undefined')return;

  /* ----------------------------------------------------------------
     Document type definitions — icon, title, description
     ---------------------------------------------------------------- */
  var docTypes=[
    {key:'operating-agreement',   icon:'fa-handshake',         title:'Operating Agreement',           desc:'Your LLC operating agreement defines ownership, roles, and rules.'},
    {key:'ein-letter',            icon:'fa-building-columns',  title:'EIN Letter (CP 575)',           desc:'IRS confirmation of your Employer Identification Number.'},
    {key:'articles-of-org',       icon:'fa-scroll',            title:'Articles of Organization',      desc:'State filing that officially creates your LLC.'},
    {key:'business-insurance',    icon:'fa-shield-halved',     title:'Business Insurance',            desc:'General liability, E&O, or other insurance policies.'},
    {key:'boi-report',            icon:'fa-users-rectangle',   title:'Beneficial Ownership Report',   desc:'FinCEN BOI report (required for most LLCs as of 2024).'},
    {key:'registered-agent',      icon:'fa-user-tie',          title:'Registered Agent',              desc:'Your registered agent designation and correspondence.'},
    {key:'w9-forms',              icon:'fa-file-lines',        title:'W-9 Forms',                     desc:'W-9 forms for your business and contractors.'},
    {key:'1099-forms',            icon:'fa-file-invoice',      title:'1099 Forms',                    desc:'1099-NEC forms for contractor payments over $600.'},
    {key:'tax-returns',           icon:'fa-landmark',          title:'Tax Returns',                   desc:'Federal and state business tax returns.'},
    {key:'contracts',             icon:'fa-file-signature',    title:'Contracts',                     desc:'Signed contracts and agreements (linked to Contracts page).'}
  ];

  var statusMap={
    'uploaded': {cls:'status-active',  text:'Uploaded'},
    'pending':  {cls:'status-pending', text:'Pending'},
    'missing':  {cls:'status-expired', text:'Missing'}
  };

  /* Find a stored document that matches a given type key */
  function findDocByType(type){
    var docs=DataStore.getDocuments();
    return docs.find(function(d){return d.docType===type;})||null;
  }

  /* Build the document category cards */
  function renderDocuments(){
    var container=document.getElementById('doc-cards-container');
    var html='';
    docTypes.forEach(function(dt){
      var doc=findDocByType(dt.key);
      var status=doc?doc.status:'missing';
      var info=statusMap[status]||statusMap['missing'];
      var hasDoc=(status==='uploaded'||status==='pending');

      html+=
        '<div class="document-card glass-card">'+
          '<div class="document-icon"><i class="fa-solid '+dt.icon+'"></i></div>'+
          '<h3>'+dt.title+'</h3>'+
          '<p class="text-muted" style="font-size:0.85rem;">'+dt.desc+'</p>'+
          '<div class="document-status" style="margin:var(--spacing-sm) 0;">'+
            '<span class="status-pill '+info.cls+'">'+info.text+'</span>'+
          '</div>'+
          '<div class="document-actions" style="display:flex;gap:8px;flex-wrap:wrap;">'+
            '<button class="btn btn-secondary btn-sm" onclick="uploadDoc(\''+dt.key+'\')">'+
              '<i class="fa-solid fa-cloud-arrow-up"></i> Upload'+
            '</button>'+
            '<button class="btn btn-ghost btn-sm" onclick="viewDoc(\''+dt.key+'\')"'+(hasDoc?'':' disabled')+'>'+
              '<i class="fa-solid fa-eye"></i> View'+
            '</button>'+
          '</div>'+
        '</div>';
    });
    container.innerHTML=html;
  }

  /* Upload / add-or-update document modal */
  function openUploadModal(preselect){
    if(typeof Modal==='undefined')return;
    var today=new Date().toISOString().split('T')[0];
    var optionsHtml='<option value="">Select type...</option>';
    docTypes.forEach(function(dt){
      optionsHtml+='<option value="'+dt.key+'"'+(preselect===dt.key?' selected':'')+'>'+dt.title+'</option>';
    });

    Modal.open({title:'Upload Document',size:'md',
      content:'<form id="modal-form">'+
        '<div class="form-group"><label class="form-label">Document Type *</label><select class="form-select" name="docType" required>'+optionsHtml+'</select></div>'+
        '<div class="form-group"><label class="form-label">File Name *</label><input type="text" class="form-input" name="fileName" required placeholder="e.g. Operating_Agreement_2026.pdf" /></div>'+
        '<div class="grid grid-2">'+
          '<div class="form-group"><label class="form-label">Date Uploaded</label><input type="date" class="form-input" name="dateUploaded" value="'+today+'" /></div>'+
          '<div class="form-group"><label class="form-label">Status</label><select class="form-select" name="status"><option value="uploaded">Uploaded</option><option value="pending">Pending</option><option value="missing">Missing</option></select></div>'+
        '</div>'+
        '<div class="form-group"><label class="form-label">Notes</label><textarea class="form-textarea" name="notes" rows="2" placeholder="Optional notes..."></textarea></div>'+
      '</form>',
      saveText:'Save Document',onSave:function(){
        var f=document.getElementById('modal-form');
        var d={};
        new FormData(f).forEach(function(v,k){d[k]=v;});
        if(!d.docType){Toast.error('Please select a document type');return;}
        if(!d.fileName){Toast.error('File name is required');return;}

        /* Check if a doc of this type already exists — update vs. add */
        var existing=findDocByType(d.docType);
        if(existing){
          DataStore.updateDocument(existing.id,d);
          Toast.success('Document updated: '+d.fileName);
        }else{
          d.name=docTypes.find(function(t){return t.key===d.docType;}).title;
          DataStore.addDocument(d);
          Toast.success('Document uploaded: '+d.fileName);
        }
        Modal.close();
        renderDocuments();
      }
    });
  }

  /* Global handlers */
  document.getElementById('upload-doc-btn').addEventListener('click',function(){openUploadModal('');});

  window.uploadDoc=function(type){openUploadModal(type);};

  window.viewDoc=function(type){
    var doc=findDocByType(type);
    if(!doc){Toast.error('No document found for this type');return;}
    if(typeof Modal==='undefined')return;
    var statusInfo=statusMap[doc.status]||statusMap['missing'];
    Modal.open({title:doc.name||doc.fileName,size:'md',
      content:
        '<div style="margin-bottom:var(--spacing-sm);">'+
          '<strong>File:</strong> '+Utils.escapeHtml(doc.fileName||'—')+
        '</div>'+
        '<div style="margin-bottom:var(--spacing-sm);">'+
          '<strong>Status:</strong> <span class="status-pill '+statusInfo.cls+'">'+statusInfo.text+'</span>'+
        '</div>'+
        '<div style="margin-bottom:var(--spacing-sm);">'+
          '<strong>Date Uploaded:</strong> '+(doc.dateUploaded?Utils.formatDate(doc.dateUploaded):'—')+
        '</div>'+
        (doc.notes?'<div style="margin-bottom:var(--spacing-sm);"><strong>Notes:</strong> '+Utils.escapeHtml(doc.notes)+'</div>':'')+
        '<div style="margin-top:var(--spacing-md);display:flex;gap:8px;">'+
          '<button class="btn btn-secondary btn-sm" onclick="uploadDoc(\''+type+'\');"><i class="fa-solid fa-cloud-arrow-up"></i> Re-Upload</button>'+
          '<button class="btn btn-ghost btn-sm text-danger" onclick="removeDoc(\''+doc.id+'\')"><i class="fa-solid fa-trash"></i> Remove</button>'+
        '</div>',
      saveText:null
    });
  };

  window.removeDoc=function(id){
    Modal.confirm('Remove this document record?',function(){
      DataStore.deleteDocument(id);
      Modal.close();
      Toast.success('Document removed');
      renderDocuments();
    });
  };

  renderDocuments();
})();
</script>
