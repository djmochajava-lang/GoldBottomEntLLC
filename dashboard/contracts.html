<!-- dashboard/contracts.html — Contract Tracker -->
<div class="dashboard-page" id="dash-contracts">
  <div class="dashboard-page-header">
    <div style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:var(--spacing-sm);">
      <div><h1>Contracts</h1><p class="text-muted">Track agreements, manage status, and monitor deadlines.</p></div>
      <button class="btn btn-primary" id="add-contract-btn"><i class="fa-solid fa-plus"></i> New Contract</button>
    </div>
  </div>

  <!-- Status Summary Cards -->
  <div class="metrics-grid" id="contract-summary"></div>

  <!-- Contracts Table -->
  <div class="card" id="contracts-table-container"></div>

  <!-- E-Signature & Templates -->
  <div class="grid grid-2" style="margin-top:var(--spacing-lg);">
    <div class="glass-card">
      <h3><i class="fa-solid fa-file-signature text-gold"></i> E-Signature Integration</h3>
      <p class="text-muted">Send contracts for electronic signature directly from the portal.</p>
      <div style="display:flex;flex-wrap:wrap;gap:8px;margin-top:var(--spacing-sm);">
        <div style="flex:1;min-width:200px;padding:var(--spacing-md);border:1px solid var(--color-border);border-radius:var(--radius-md);">
          <strong>DocuSign</strong>
          <span class="status-pill status-expired" style="margin-left:8px;font-size:.7rem;">Not Connected</span>
          <p class="text-muted" style="font-size:.85rem;margin-top:4px;">Industry-standard e-signatures</p>
          <button class="btn btn-secondary btn-sm" style="margin-top:8px;">Connect</button>
        </div>
        <div style="flex:1;min-width:200px;padding:var(--spacing-md);border:1px solid var(--color-border);border-radius:var(--radius-md);">
          <strong>HelloSign</strong>
          <span class="status-pill status-expired" style="margin-left:8px;font-size:.7rem;">Not Connected</span>
          <p class="text-muted" style="font-size:.85rem;margin-top:4px;">Simple, developer-friendly e-sign</p>
          <button class="btn btn-secondary btn-sm" style="margin-top:8px;">Connect</button>
        </div>
      </div>
    </div>
    <div class="glass-card">
      <h3><i class="fa-solid fa-folder-open text-gold"></i> Contract Templates</h3>
      <p class="text-muted">Start from professionally drafted contract templates.</p>
      <ul style="list-style:disc;padding-left:20px;color:var(--color-text-secondary);margin:var(--spacing-sm) 0;">
        <li>Artist Management Agreement</li>
        <li>Booking / Performance Agreement</li>
        <li>Distribution Agreement</li>
        <li>Software Development Contract</li>
        <li>Licensing Agreement</li>
      </ul>
      <div style="display:flex;flex-wrap:wrap;gap:8px;margin-top:var(--spacing-sm);">
        <a href="https://www.legalzoom.com" target="_blank" rel="noopener" class="btn btn-ghost btn-sm"><i class="fa-solid fa-arrow-up-right-from-square"></i> LegalZoom</a>
        <a href="https://www.rocketlawyer.com" target="_blank" rel="noopener" class="btn btn-ghost btn-sm"><i class="fa-solid fa-arrow-up-right-from-square"></i> Rocket Lawyer</a>
        <a href="https://www.pandadoc.com" target="_blank" rel="noopener" class="btn btn-ghost btn-sm"><i class="fa-solid fa-arrow-up-right-from-square"></i> PandaDoc</a>
      </div>
    </div>
  </div>
</div>

<script>
(function(){
  if(typeof DataStore==='undefined')return;

  var typeLabels={management:'Management',booking:'Booking',distribution:'Distribution',license:'License',development:'Development'};
  var typeBadges={management:'badge-gold',booking:'badge-info',distribution:'badge-success',license:'badge-warning',development:'badge-primary'};
  var statusColors={'draft':'status-draft','sent':'status-pending','signed':'status-active','expired':'status-expired'};

  function renderSummary(){
    var data=DataStore.getContracts();
    var counts={draft:0,sent:0,signed:0,expired:0};
    data.forEach(function(c){counts[c.status]=(counts[c.status]||0)+1;});
    var cards=[
      {label:'Draft',count:counts.draft,icon:'fa-file',color:'#8b949e'},
      {label:'Sent',count:counts.sent,icon:'fa-paper-plane',color:'#d29922'},
      {label:'Active / Signed',count:counts.signed,icon:'fa-circle-check',color:'#3fb950'},
      {label:'Expired',count:counts.expired,icon:'fa-clock',color:'#f85149'}
    ];
    var html='';
    cards.forEach(function(c){
      html+='<div class="metric-card glass-card"><div class="metric-icon" style="background:rgba('+hexToRgb(c.color)+',0.15);color:'+c.color+';"><i class="fa-solid '+c.icon+'"></i></div><div class="metric-info"><span class="metric-value">'+c.count+'</span><span class="metric-label">'+c.label+'</span></div></div>';
    });
    document.getElementById('contract-summary').innerHTML=html;
  }

  function hexToRgb(hex){var r=parseInt(hex.slice(1,3),16),g=parseInt(hex.slice(3,5),16),b=parseInt(hex.slice(5,7),16);return r+','+g+','+b;}

  function renderTable(){
    var c=document.getElementById('contracts-table-container');
    var data=DataStore.getContracts();
    if(!data.length){
      c.innerHTML='<div class="empty-state"><div class="empty-state-icon"><i class="fa-solid fa-file-signature"></i></div><h3 class="empty-state-title">No contracts yet</h3><p class="empty-state-text">Create your first contract to start tracking agreements.</p></div>';
      return;
    }
    var html='<table class="data-table"><thead><tr><th>Title</th><th>Type</th><th>Parties</th><th>Status</th><th>Start</th><th>End</th><th>Value</th><th>Actions</th></tr></thead><tbody>';
    data.forEach(function(ct){
      var fmt=typeof Utils!=='undefined'?Utils:{formatCurrency:function(v){return '$'+Number(v||0).toLocaleString();},formatDate:function(d){return d||'—';}};
      html+='<tr>'+
        '<td data-label="Title"><strong>'+ct.title+'</strong></td>'+
        '<td data-label="Type"><span class="badge '+(typeBadges[ct.type]||'badge-gold')+'">'+(typeLabels[ct.type]||ct.type)+'</span></td>'+
        '<td data-label="Parties">'+(ct.partyA||'GBE')+' &harr; '+(ct.partyB||'—')+'</td>'+
        '<td data-label="Status"><span class="status-pill '+(statusColors[ct.status]||'status-draft')+'">'+(ct.status||'draft')+'</span></td>'+
        '<td data-label="Start">'+fmt.formatDate(ct.startDate)+'</td>'+
        '<td data-label="End">'+fmt.formatDate(ct.endDate)+'</td>'+
        '<td data-label="Value">'+fmt.formatCurrency(ct.value||0)+'</td>'+
        '<td data-label="Actions"><div class="data-table-actions">'+
          '<button class="btn btn-ghost btn-sm" onclick="editContract(\''+ct.id+'\')"><i class="fa-solid fa-pen"></i></button>'+
          '<button class="btn btn-ghost btn-sm text-danger" onclick="deleteContract(\''+ct.id+'\')"><i class="fa-solid fa-trash"></i></button>'+
        '</div></td></tr>';
    });
    html+='</tbody></table>';
    c.innerHTML=html;
  }

  function getFormHtml(ct){
    ct=ct||{};
    return '<form id="modal-form">'+
      '<div class="grid grid-2">'+
        '<div class="form-group"><label class="form-label">Title *</label><input type="text" class="form-input" name="title" value="'+(ct.title||'')+'" required /></div>'+
        '<div class="form-group"><label class="form-label">Type *</label><select class="form-select" name="type" required>'+
          '<option value="">Select...</option>'+
          '<option value="management"'+(ct.type==='management'?' selected':'')+'>Management</option>'+
          '<option value="booking"'+(ct.type==='booking'?' selected':'')+'>Booking</option>'+
          '<option value="distribution"'+(ct.type==='distribution'?' selected':'')+'>Distribution</option>'+
          '<option value="license"'+(ct.type==='license'?' selected':'')+'>License</option>'+
          '<option value="development"'+(ct.type==='development'?' selected':'')+'>Development</option>'+
        '</select></div>'+
      '</div>'+
      '<div class="grid grid-2">'+
        '<div class="form-group"><label class="form-label">Party A</label><input type="text" class="form-input" name="partyA" value="'+(ct.partyA||'Gold Bottom Ent LLC')+'" /></div>'+
        '<div class="form-group"><label class="form-label">Party B</label><input type="text" class="form-input" name="partyB" value="'+(ct.partyB||'')+'" /></div>'+
      '</div>'+
      '<div class="grid grid-2">'+
        '<div class="form-group"><label class="form-label">Status</label><select class="form-select" name="status">'+
          '<option value="draft"'+(ct.status==='draft'?' selected':'')+'>Draft</option>'+
          '<option value="sent"'+(ct.status==='sent'?' selected':'')+'>Sent</option>'+
          '<option value="signed"'+(ct.status==='signed'?' selected':'')+'>Signed / Active</option>'+
          '<option value="expired"'+(ct.status==='expired'?' selected':'')+'>Expired</option>'+
        '</select></div>'+
        '<div class="form-group"><label class="form-label">Value ($)</label><input type="number" class="form-input" name="value" value="'+(ct.value||'')+'" min="0" step="0.01" /></div>'+
      '</div>'+
      '<div class="grid grid-2">'+
        '<div class="form-group"><label class="form-label">Start Date</label><input type="date" class="form-input" name="startDate" value="'+(ct.startDate||'')+'" /></div>'+
        '<div class="form-group"><label class="form-label">End Date</label><input type="date" class="form-input" name="endDate" value="'+(ct.endDate||'')+'" /></div>'+
      '</div>'+
      '<div class="form-group"><label class="form-label">Commission %</label><input type="number" class="form-input" name="commissionPct" value="'+(ct.commissionPct||15)+'" min="0" max="100" /></div>'+
      '<div class="form-group"><label class="form-label">Notes</label><textarea class="form-textarea" name="notes" rows="2">'+(ct.notes||'')+'</textarea></div>'+
    '</form>';
  }

  document.getElementById('add-contract-btn').addEventListener('click',function(){
    Modal.open({title:'New Contract',size:'lg',content:getFormHtml(),saveText:'Create',
      onSave:function(){
        var f=document.getElementById('modal-form');
        var d={};new FormData(f).forEach(function(v,k){d[k]=v;});
        if(!d.title){Toast.error('Title is required');return;}
        d.value=parseFloat(d.value)||0;
        d.commissionPct=parseInt(d.commissionPct)||15;
        DataStore.addContract(d);
        Modal.close();Toast.success('Contract created: '+d.title);
        renderSummary();renderTable();
      }
    });
  });

  window.editContract=function(id){
    var ct=DataStore.getContract(id);if(!ct)return;
    Modal.open({title:'Edit: '+ct.title,size:'lg',content:getFormHtml(ct),saveText:'Save',
      onSave:function(){
        var f=document.getElementById('modal-form');
        var d={};new FormData(f).forEach(function(v,k){d[k]=v;});
        d.value=parseFloat(d.value)||0;
        d.commissionPct=parseInt(d.commissionPct)||15;
        DataStore.updateContract(id,d);
        Modal.close();Toast.success('Contract updated');
        renderSummary();renderTable();
      }
    });
  };

  window.deleteContract=function(id){
    var ct=DataStore.getContract(id);if(!ct)return;
    Modal.confirm('Delete "'+ct.title+'"?',function(){
      DataStore.deleteContract(id);Toast.success('Contract deleted');
      renderSummary();renderTable();
    });
  };

  renderSummary();renderTable();
})();
</script>
